"use strict";function jsonp(o,e,t){var n=document.createElement("script");n.type="text/javascript";var i=Date.now()+String(Math.floor(100*Math.random()));n.src=o+(o.indexOf("?")>0?"&":"?")+"callback=CB"+i,n.onload=function(){n.parentNode.removeChild(n)},n.onerror=function(o){t&&t(o)},window["CB"+i]=function(o){e(o)},document.head.appendChild(n)}function createCookie(o,e,t){var n="";if(t){var i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3),n="; expires="+i.toGMTString()}document.cookie=o+"="+e+n+"; path=/"}function readCookie(o){for(var e=o+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null}function eraseCookie(o){createCookie(o,"",-1)}AV.initialize("kusn9e3cp5znt5lic9fufqfmsvsibsoaejpah089x6v2n7e0","nt5l8v4n4m08zxttpt7upqxwgt6oy47lzb3f8c4juf34otfm");var WECHAT={AppID:"wx2940a8d3ddcad5e9"},APP=angular.module("APP",["ionic"],null).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(o,e,t){t.tabs.style("standard"),t.tabs.position("bottom"),o.state("tab",{url:"/tab","abstract":!0,templateUrl:"temp/tabs.html"}).state("tab.book_recommend",{url:"/book/recommend",views:{"tab-book":{templateUrl:"temp/book/recommend.html"}}}).state("tab.book_searchList",{url:"/book/searchList/:keyword",views:{"tab-book":{templateUrl:"temp/book/searchList.html"}}}).state("tab.book_bookList",{url:"/book/bookList?cmd&title&tag",views:{"tab-book":{templateUrl:"temp/book/bookList.html"}}}).state("tab.book_usedBookList",{url:"/book/usedBookList?cmd&isbn13",views:{"tab-book":{templateUrl:"temp/book/usedBookList.html"}}}).state("tab.book_oneBook",{url:"/book/oneBook/:isbn13",views:{"tab-book":{templateUrl:"temp/book/oneBook.html"}}}).state("tab.book_oneUsedBook",{url:"/book/oneUsedBook/:usedBookAvosObjectId",views:{"tab-book":{templateUrl:"temp/book/oneUsedBook.html"}}}).state("tab.book_bookReview",{url:"/book/oneUsedBook?doubanBookId&bookTitle",views:{"tab-book":{templateUrl:"temp/book/bookReview.html"}}}).state("tab.person_editOneUsedBook",{url:"/person/editOneUsedBook/:indexInMyAvosUsedBook_notSell",views:{"tab-person":{templateUrl:"temp/person/editOneUsedBook.html"}}}).state("tab.person_uploadOneUsedBook",{url:"/person/uploadOneUsedBook/:isbn13",views:{"tab-person":{templateUrl:"temp/person/uploadOneUsedBook.html"}}}).state("tab.person_usedBooksList",{url:"/person/usedBookList",views:{"tab-person":{templateUrl:"temp/person/usedBookList.html"}}}).state("tab.person_editPersonInfo",{url:"/person/editPersonInfo",views:{"tab-person":{templateUrl:"temp/person/editPersonInfo.html"}}}).state("tab.person_my",{url:"/person/my",views:{"tab-person":{templateUrl:"temp/person/my.html"}}}).state("tab.person_sendMsgToUser",{url:"/person/sendMsgToUser?receiverObjectId&usedBookObjectId&role&inboxType",views:{"tab-person":{templateUrl:"temp/person/sendMsgToUser.html"}}}).state("tab.hello",{url:"/hello?state",views:{"tab-person":{templateUrl:"temp/tool/hello.html"}}}).state("tab.signUp",{url:"/signUp?code&state",views:{"tab-person":{templateUrl:"temp/tool/signUp.html"}}}).state("tab.userList",{url:"/userList?cmd&title",views:{"tab-book":{templateUrl:"temp/tool/userList.html"}}}).state("tab.userHome",{url:"/userHome/:ownerId",views:{"tab-book":{templateUrl:"temp/tool/userHome.html"}}}),e.otherwise("/tab/book/recommend")}]);APP.run(["$rootScope","$state","User$","Status$","WeChatJS$",function(o,e,t,n,i){i.config(),t.loginWithUnionId(readCookie("unionId")),o.$on("$stateChangeStart",function(o,n){var i=n.name;i.indexOf("tab.person_")>=0&&(t.getCurrentAvosUser()||(o.preventDefault(),e.go("tab.hello",{state:i})))})}]),APP.service("DoubanBook$",["$rootScope",function(o){function e(o){for(var e=o.substring(3,12),t=0,n=0;9>n;n++){var i=parseInt(e.charAt(n));t+=i*(10-n)}var s=t%11,a=11-s,r=String(a);return 10==a?r="X":11==a&&(r="0"),String(e+r)}var t=this,n="http://api.douban.com/v2/book";this.getBookByISBD=function(o,i,s){var a=n+"/isbn/"+o;null==s&&(s="id,rating,author,pubdate,image,binding,translator,catalog,pages,publisher,isbn13,title,author_intro,summary,price"),a+="?fields="+s,jsonp(a,function(o){i(o)},function(){13==o.length?t.getBookByISBD(e(o),function(o){i(o)},s):i(null)})},this.getBookByISBD_simple=function(o,e){t.getBookByISBD(o,e,"author,pubdate,image,publisher,title,price,isbn13")},this.searchBooks=function(o,e,t,i){var s=n+"/search";return o&&o.length<1?[]:(s+="?q="+o,e&&(s+="&start="+e),t&&(s+="&count="+t),s+="&fields=isbn13,title,image,author,publisher,pubdate,price",void jsonp(s,function(o){i(o)}))},this.getBooksByTag=function(o,e,t,i){var s=n+"/search";return!o||o.length<1?[]:(s+="?tag="+o,e&&(s+="&start="+e),t&&(s+="&count="+t),s+="&fields=isbn13,title,image,author,publisher,pubdate,price",void jsonp(s,function(o){i(o)}))},this.BookReview={reviewList:[],nowBookId:null,hasMoreFlag:!0,loadMore:function(){AV.Cloud.run("getDoubanBookReview",{id:t.BookReview.nowBookId,start:t.BookReview.reviewList.length},null).done(function(e){if(e.length>0)for(var n=0;n<e.length;n++)t.BookReview.reviewList.push(e[n]);else t.BookReview.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return t.BookReview.hasMoreFlag},clear:function(){t.BookReview.reviewList=[],t.BookReview.hasMoreFlag=!0,o.$broadcast("scroll.infiniteScrollComplete")},getOneFullReview:function(o){return AV.Cloud.run("getOneFullDoubanBookReview",{id:o},null)}}}]).service("SearchBook$",["$rootScope","DoubanBook$","$timeout",function(o,e,t){var n=this;this.keyword="",this.books=[],this.hasMore=function(){return n.books.length<n.totalNum},this.totalNum=0,this.loadMore=function(){n.keyword.length>0&&e.searchBooks(n.keyword,n.books.length,10,function(e){n.totalNum=e.total;for(var t=e.books,i=0;i<t.length;i++)n.books.push(t[i]);o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})};var i=null;this.searchBtnOnClick=function(){n.loadMore(),t.cancel(i)},this.searchInputOnChange=function(){n.books=[],n.totalNum=0,t.cancel(i),i=t(function(){n.searchBtnOnClick()},1e3)}}]).service("BookRecommend$",["$rootScope","DoubanBook$","User$","UsedBook$",function(o,e,t,n){var i=this;this.LoadCount=Math.floor(document.body.clientWidth/80),this.NewBook={books:[],hasMoreFlag:!0,loadMore:function(){AV.Cloud.run("getNewBooks",{start:i.NewBook.books.length,count:i.LoadCount},null).done(function(e){if(e.length>0)for(var t=0;t<e.length;t++)i.NewBook.books.push(e[t]);else i.NewBook.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return i.NewBook.hasMoreFlag}},i.NewBook.loadMore(),this.BookTag={tag:null,load:function(){AV.Cloud.run("getAllBookTags",null,null).done(function(e){i.BookTag.tag=e,o.$apply()})},getTagAttrNames:function(){return i.BookTag.tag?Object.keys(i.BookTag.tag):[]}},this.BookTag.load(),this.TagBook={nowTag:"",setTag:function(o){o!=i.TagBook.nowTag&&(i.TagBook.books=[],i.TagBook.nowTag=o)},books:[],hasMoreFlag:!0,loadMore:function(){e.getBooksByTag(i.TagBook.nowTag,i.TagBook.books.length,i.LoadCount,function(e){var t=e.books;if(t.length>0)for(var n=0;n<t.length;n++)i.TagBook.books.push(t[n]);else i.TagBook.hasMoreTag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return i.TagBook.hasMoreFlag}},this.MajorBook={major:t.getCurrentJsonUser()?t.getCurrentJsonUser().major:"",books:[],hasMoreFlag:!0,randomStart:(new Date).getDay()*Math.floor(10*Math.random()),loadMore:function(){e.getBooksByTag(i.MajorBook.major,i.MajorBook.books.length+i.MajorBook.randomStart,i.LoadCount,function(e){i.MajorBook.totalNum=e.total;var t=e.books;if(t.length>0)for(var n=0;n<t.length;n++)i.MajorBook.books.push(t[n]);else i.MajorBook.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return i.MajorBook.hasMoreFlag}},this.NeedBook={books:[],loadMore:function(){}},this.NearBook={jsonBooks:[],hasMoreFlag:!0,loadMore:function(){var e=t.getCurrentUserLocation(),s=new AV.Query("UsedBook");e&&s.near("location",e),s.skip(i.NearBook.jsonBooks.length),s.limit(i.LoadCount),s.find().done(function(e){if(e.length>0)for(var t=0;t<e.length;t++)i.NearBook.jsonBooks.push(n.avosUsedBookToJson(e[t]));else i.NearBook.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return i.NearBook.hasMoreFlag}},this.NearUser={jsonUsers:[],hasMoreFlag:!0,loadMore:function(){var e=t.getCurrentUserLocation(),n=new AV.Query(AV.User);e&&n.near("location",e),n.skip(i.NearUser.jsonUsers.length),n.limit(Math.floor(document.body.clientWidth/50)),n.find().done(function(e){if(e.length>0)for(var n=0;n<e.length;n++)i.NearUser.jsonUsers.push(t.avosUserToJson(e[n]));else i.NearUser.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMore:function(){return i.NearUser.hasMoreFlag}},this.NearUser.loadMore()}]).service("BusinessSite$",function(){this.getBusinessInfoByISBN=function(o){return AV.Cloud.run("getBusinessInfo",{id:o},null)}}).service("WeChatJS$",["$rootScope",function(o){function e(o){var e={title:"书循",desc:"让你的课本重复利用",link:window.location.href,imgUrl:"http://"+window.location.host+"/wechat/img/logo-R.png"};return e=angular.extend(e,o)}var t=this;this.config=function(){AV.Cloud.run("getWechatJsConfig",{url:location.href.split("#")[0]},null).done(function(o){wx.config(o)})},wx.ready(function(){wx.onMenuShareTimeline(e()),wx.onMenuShareAppMessage(e()),wx.onMenuShareQQ(e()),wx.onMenuShareWeibo(e()),wx.getLocation({success:function(o){AV.Cloud.run("updateMyLocation",{latitude:o.latitude,longitude:o.longitude},null)},fail:function(){AV.Cloud.run("updateMyLocation",null,null)},cancel:function(){AV.Cloud.run("updateMyLocation",null,null)}})}),wx.error(function(){t.config()}),this.scanQRCode=function(e){wx.scanQRCode({needResult:1,success:function(t){e(t.resultStr.split(",")[1]),o.$apply()}})},this.previewOneImage=function(o){wx.previewImage({current:o,urls:[o]})},this.getOAuthURL=function(o){var e=location.href.split("#")[0]+"#tab/signUp";return"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+WECHAT.AppID+"&redirect_uri="+encodeURIComponent(e)+"&response_type=code&scope=snsapi_userinfo&state="+o+"#wechat_redirect"},this.getOAuthUserInfo=function(o,e,t){AV.Cloud.run("getWechatOAuthUserInfo",{code:o},null).done(function(o){var t={openId:o.openid,unionId:o.unionid,nickName:o.nickname,sex:o.sex,avatarUrl:o.headimgurl};createCookie("unionId",t.unionId,365),e(t)}).fail(function(o){t(o)})},this.openMap=function(o,e){jsonp("http://apis.map.qq.com/ws/coord/v1/translate?type=1&key=R3DBZ-HEYRF-ZSZJ3-JAJJN-2ZWFF-SLBJV&output=jsonp&locations="+o+","+e,function(o){if(0==o.status){var e=o.locations[0];wx.openLocation({latitude:e.lat,longitude:e.lng,name:"该同学位置"})}})}}]).service("InfoService$",["$rootScope","$http","User$",function(o,e,t){var n=this;this.majors=[],AV.Cloud.run("getAllMajor",null,null).done(function(o){n.majors=o}),this.searchMajorKeyword="",this.filter_majorByKeyword=function(o){return o.name.indexOf(n.searchMajorKeyword)>-1},this.School={schools:[],loadMore:function(){var e=t.getCurrentUserLocation(),i=new AV.Query("School");e&&i.near("location",e),n.School.searchSchoolKeyword.length>0?i.startsWith("name",n.School.searchSchoolKeyword):(i.skip(n.School.schools.length),i.limit(10)),i.find().done(function(e){if(e.length>0)for(var t=0;t<e.length;t++)n.School.schools.push(e[t].get("name"));o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},searchSchoolKeyword:"",filter_schoolByKeyword:function(o){return o.indexOf(n.School.searchSchoolKeyword)>=0}},this.startSchoolYearOptions=[];for(var i=(new Date).getFullYear(),s=i-6;i>=s;s++)n.startSchoolYearOptions.push(s.toString())}]).service("IonicModalView$",["$rootScope","$ionicModal","$ionicHistory","InfoService$",function(o,e,t,n){this.registerChooseSchoolModalView=function(o,t){o.InfoService$=n,e.fromTemplateUrl("temp/tool/chooseSchoolModalView.html",{scope:o}).then(function(e){o.chooseSchoolModalView=e}),o.schoolOnChoose=function(e){t(e),o.chooseSchoolModalView.hide()}},this.registerChooseMajorModalView=function(o,t){o.InfoService$=n,e.fromTemplateUrl("temp/tool/chooseMajorModalView.html",{scope:o}).then(function(e){o.chooseMajorModalView=e}),o.majorOnChoose=function(e){t(e),o.chooseMajorModalView.hide()}},this.alertTitleAndPreModalView=function(t,n){var i=o.$new(!0);i.titleAndPreModalViewData={title:t,pre:n},e.fromTemplateUrl("temp/tool/titleAndPreModalView.html",{scope:i}).then(function(o){i.titleAndPreModalView=o,o.show()})}}]).service("User$",["$rootScope","Status$",function(o,e){var t=this,n=["openId","nickName","avatarUrl","sex","school","major","startSchoolYear"];this.signUpWithJSONUser=function(o){var e=t.jsonToAvosUser(o);return e.set("username",o.unionId),e.set("password",o.unionId),e.signUp(null)},this.getCurrentUserLocation=function(){var o=t.getCurrentAvosUser();return o?o.get("location"):null},this.getCurrentAvosUser=function(){return AV.User.current()},this.getCurrentJsonUser=function(){var o=t.getCurrentAvosUser();return o?t.avosUserToJson(o):null},this.avosUserToJson=function(o){for(var e={},t=0;t<n.length;t++){var i=n[t];e[i]=o.get(i)}return e.objectId=o.id,e.location=o.get("location"),e},this.jsonToAvosUser=function(o){for(var e=new AV.User,t=0;t<n.length;t++){var i=n[t];e.set(i,o[i])}return e},this.followUser=function(e){var n=t.getCurrentAvosUser();n?n.follow(e).done(function(){o.$broadcast("FollowSomeone")}).fail(function(o){alert("关注失败:"+o.message)}):alert("请先登入")},this.unfollowUser=function(e){var n=t.getCurrentAvosUser();n?n.unfollow(e).done(function(){o.$broadcast("UnfollowSomeone")}).fail(function(o){alert("取消关注失败:"+o.message)}):alert("请先登入")},this.Followee={jsonUserList:[],loadMore:function(){var e=AV.User.current().followeeQuery();e.include("followee"),e.skip(t.Followee.jsonUserList.length),e.limit(10),e.find().done(function(e){if(e.length>0)for(var n=0;n<e.length;n++)t.Followee.jsonUserList.push(t.avosUserToJson(e[n]));else t.Followee.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMoreFlag:!0,hasMore:function(){return t.Followee.hasMoreFlag}},this.Follower={jsonUserList:[],loadMore:function(){var e=AV.User.current().followerQuery();e.include("follower"),e.skip(t.Follower.jsonUserList.length),e.limit(10),e.find().done(function(e){if(e.length>0)for(var n=0;n<e.length;n++)t.Follower.jsonUserList.push(t.avosUserToJson(e[n]));else t.Follower.hasMoreFlag=!1;o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})},hasMoreFlag:!0,hasMore:function(){return t.Follower.hasMoreFlag}},this.changeWechatAvatarSize=function(o,e){return o?o.substring(0,o.length-1)+e:null},this.loginWithUnionId=function(o){var t=new AV.Promise(null);return o?AV.User.logIn(o,o).done(function(o){t.resolve(o),e.loadUnreadStatusesCount()}).fail(function(o){t.reject(o)}):t.reject("unionId错误"),t}}]).service("UsedBook$",["$rootScope",function(o){var e=this,t=["owner","isbn13","price","des","image","title"];this.isLoading=!1,this.loadUsedBookListForOwner=function(o){return o.relation("usedBooks").query().find()},this.myAvosUsedBookList=[],this.loadMyAvosUsedBookList=function(){e.isLoading=!0;var t=AV.User.current().relation("usedBooks").query();t.descending("updatedAt"),t.find().done(function(o){e.myAvosUsedBookList=o}).always(function(){e.isLoading=!1,o.$apply()})},this.removeUsedBook=function(o){window.confirm("你确定要删除它吗?将不可恢复")&&o.destroy().done(function(){e.loadMyAvosUsedBookList()}).fail(function(o){alert(o.message)})},this.avosUsedBookToJson=function(o){for(var e={},n=0;n<t.length;n++){var i=t[n];e[i]=o.get(i)}return e.objectId=o.id,e.updatedAt=o.updatedAt,e},this.jsonUsedBookToAvos=function(o){for(var e=AV.Object.extend("UsedBook"),n=new e,i=0;i<t.length;i++){var s=t[i];n.set(s,o[s])}return n},this.getJsonUsedBookByAvosObjectId=function(o,t){var n=new AV.Query("UsedBook");n.get(o).done(function(o){t(e.avosUsedBookToJson(o))})},this.getUsedBookNumberEqualISBN=function(o){var e=new AV.Query("UsedBook");return e.equalTo("isbn13",o),e.count()},this.ISBN={nowISBN13:"",nowEqualISBNJsonUsedBookList:[],loadMoreUsedBookEqualISBN:function(t){e.isLoading=!0,t!=e.ISBN.nowISBN13&&(e.ISBN.nowISBN13=t,e.ISBN.nowEqualISBNJsonUsedBookList=[]);var n=new AV.Query("UsedBook");n.equalTo("isbn13",e.ISBN.nowISBN13),n.descending("updatedAt"),n.skip(e.ISBN.nowEqualISBNJsonUsedBookList.length),n.limit(5),n.include("owner"),n.find().done(function(o){if(o.length>0)for(var t=0;t<o.length;t++)e.ISBN.nowEqualISBNJsonUsedBookList.push(e.avosUsedBookToJson(o[t]))}).always(function(){e.isLoading=!1,o.$apply(),o.$broadcast("scroll.infiniteScrollComplete")})}}}]).service("Status$",["$rootScope",function(o){var e=this,t=["inboxType","message","source","to","usedBook"];this.unreadStatusesCount=null,this.loadUnreadStatusesCount=function(){var t=AV.User.current();t&&AV.Status.countUnreadStatuses(t).done(function(t){var n=parseInt(t.unread);e.unreadStatusesCount=n>0?String(n):null,o.$apply()})},this.avosStatusToJson=function(o){for(var e={},n=0;n<t.length;n++)e[t[n]]=o.get(t[n]);return e.updatedAt=o.get("updatedAt"),e.objectId=o.id,e},this.sendPrivateMsg=function(o,e,t){var n=new AV.Status(null,e);return n.set("to",AV.Object.createWithoutData("_User",o)),n.set("role",t),AV.Status.sendPrivateStatus(n,o)},this.reviewUsedBook=function(o,e,t){var n=new AV.Promise(null),i=new AV.Query("UsedBook");return i.select("owner"),i.get(o).done(function(o){var s=o.get("owner");i=new AV.Query(AV.User),i.equalTo("objectId",s.id);var a=new AV.Status(null,e);a.query=i,a.inboxType="reviewUsedBook",a.set("to",s),a.set("role",t),a.set("usedBook",o),a.send().done(function(o){n.resolve(o)}).fail(function(o){n.reject(o)})}).fail(function(o){n.reject(o)}),n},this.getStatusList_reviewBook=function(o){var e=new AV.Query("_Status"),t=AV.Object.createWithoutData("UsedBook",o);return e.equalTo("inboxType","reviewUsedBook"),e.equalTo("usedBook",t),e.find()},this.getStatusList_twoUser=function(o,e){var t=AV.User.current(),n=AV.Object.createWithoutData("_User",o),i=new AV.Query("_Status");i.equalTo("source",t),i.equalTo("to",n);var s=new AV.Query("_Status");if(s.equalTo("source",n),s.equalTo("to",t),e){var a=AV.Object.createWithoutData("UsedBook",e);i.equalTo("usedBook",a),s.equalTo("usedBook",a)}var r=AV.Query.or(i,s);return r.find()}}]),APP.controller("tabs",["$scope","Status$",function(o,e){o.Status$=e}]).controller("book_recommend",["$scope","$ionicModal","BookRecommend$","User$",function(o,e,t,n){o.User$=n,o.BookRecommend$=t,t.MajorBook.loadMore(),t.NeedBook.loadMore(),t.NearBook.loadMore(),e.fromTemplateUrl("template/bookTags.html",{scope:o}).then(function(e){o.bookTagsModalView=e})}]).controller("book_searchList",["$scope","$timeout","$state","$stateParams","SearchBook$","WeChatJS$",function(o,e,t,n,i,s){o.SearchBook$=i;var a=n.keyword;a&&(i.keyword=a,i.searchBtnOnClick()),o.scanQRBtnOnClick=function(){s.scanQRCode(function(o){o&&o.length>=10&&o.length<=13?t.go("tab.book_oneBook",{isbn13:o}):alert("不合法的ISBN号")})}}]).controller("book_bookList",["$scope","$stateParams","BookRecommend$",function(o,e,t){o.title=e.title;var n=e.cmd;if("tag"==n){var i=e.tag;t.TagBook.setTag(i),t.TagBook.loadMore(),o.title=i,o.books=t.TagBook.books,o.loadMore=t.TagBook.loadMore,o.hasMore=t.TagBook.hasMore}else"need"==n?(o.books=t.NeedBook.books,o.loadMore=t.NeedBook.loadMore,o.hasMore=t.NeedBook.hasMore):"major"==n?(o.books=t.MajorBook.books,o.loadMore=t.MajorBook.loadMore,o.title=t.MajorBook.major,o.hasMore=t.MajorBook.hasMore):"new"==n&&(o.books=t.NewBook.books,o.loadMore=t.NewBook.loadMore,o.title="新书速递",o.hasMore=t.NewBook.hasMore)}]).controller("book_usedBookList",["$scope","$stateParams","UsedBook$","BookRecommend$",function(o,e,t,n){var i=e.cmd;if(o.sortWay="","near"==i)o.title="你附近的二手书",o.jsonUsedBooks=n.NearBook.jsonBooks,o.loadMore=n.NearBook.loadMore,o.hasMore=n.NearBook.hasMore;else if("isbn"==i){o.title="对应的二手书";var s=e.isbn13;t.ISBN.loadMoreUsedBookEqualISBN(s),o.jsonUsedBooks=t.ISBN.nowEqualISBNJsonUsedBookList,o.loadMore=t.ISBN.loadMoreUsedBookEqualISBN(s),o.hasMore=n.ISBN.hasMore}}]).controller("book_oneBook",["$scope","$state","$stateParams","$ionicModal","DoubanBook$","WeChatJS$","InfoService$","UsedBook$","IonicModalView$","BusinessSite$",function(o,e,t,n,i,s,a,r,l,u){o.isbn13=t.isbn13,o.book=null,o.isLoading=!0,i.getBookByISBD(o.isbn13,function(t){t?(t.image=t.image.replace("mpic","lpic"),o.book=t,o.isbn13=t.isbn13,o.isLoading=!1,o.$apply(),u.getBusinessInfoByISBN(t.id).done(function(e){o.businessInfos=e})):(alert("没有找到图书信息,再去搜搜看~"),e.go("tab.book_searchList"))}),o.showAuthorIntro=function(){var e=o.book.author.toString(),t=o.book.author_intro;l.alertTitleAndPreModalView(e,t)},o.showPubInfo=function(){var e="出版信息",t=o.book,n="作者:"+t.author.toString()+"\n出版社:"+t.publisher+"\n出版年:"+t.pubdate+"\n页数:"+t.pages+"\n定价:"+t.price+"\n装帧:"+t.binding+"\nISBN:"+t.isbn13+"\n目录:\n"+t.catalog;l.alertTitleAndPreModalView(e,n)},o.showSummary=function(){var e="图书简介",t=o.book.summary;l.alertTitleAndPreModalView(e,t)},o.UsedBook$=r,r.getUsedBookNumberEqualISBN(o.isbn13).done(function(e){o.usedBookNumber=e}),r.ISBN.loadMoreUsedBookEqualISBN(o.isbn13),o.WeChatJS$=s}]).controller("book_bookReview",["$scope","$stateParams","DoubanBook$","IonicModalView$",function(o,e,t,n){o.BookReview=t.BookReview,o.BookReview.nowBookId=e.doubanBookId,o.title=e.bookTitle+" 书评",o.$on("$ionicView.afterLeave",function(){o.BookReview.clear()}),o.showFull=function(o,e){t.BookReview.getOneFullReview(e).done(function(e){n.alertTitleAndPreModalView(o,e)})}}]).controller("book_oneUsedBook",["$scope","$stateParams","UsedBook$","User$","WeChatJS$","Status$",function(o,e,t,n,i,s){o.User$=n,o.WeChatJS$=i,o.usedBookObjectId=e.usedBookAvosObjectId,t.getJsonUsedBookByAvosObjectId(o.usedBookObjectId,function(e){e.image=e.image?e.image.replace("mpic","lpic"):"",o.jsonUsedBook=e,o.$apply();var t=o.jsonUsedBook.owner;t.fetch().done(function(e){o.ownerInfo=n.avosUserToJson(e),o.$apply()})}),s.getStatusList_reviewBook(o.usedBookObjectId).done(function(e){o.jsonStatusList=[];for(var t=0;t<e.length;t++){var n=s.avosStatusToJson(e[t]);n.source.fetch().done(function(){o.$apply()}),n.to.fetch().done(function(){o.$apply()}),o.jsonStatusList.push(n)}o.$apply()})}]).controller("person_uploadOneUsedBook",["$scope","$state","$stateParams","$ionicHistory","$ionicScrollDelegate","$ionicModal","DoubanBook$","WeChatJS$","UsedBook$","User$",function(o,e,t,n,i,s,a,r,l,u){function c(){o.isLoading=!0,a.getBookByISBD_simple(o.usedBookInfo.isbn13,function(t){t?(o.doubanBookInfo=t,o.usedBookInfo.isbn13=t.isbn13,o.isLoading=!1,o.usedBookInfo.image=t.image.replace("mpic","lpic"),o.usedBookInfo.title=t.title,o.$apply()):(alert("没有找到图书信息,再去搜搜看~"),e.go("tab.book_searchList"))})}o.isLoading=!1,o.WeChatJS$=r,o.$on("$ionicView.afterEnter",function(){o.usedBookInfo={isbn13:t.isbn13,price:null,des:null,image:"",title:""},i.scrollTop(),o.usedBookInfo.isbn13&&c(),o.usedBookInfo.owner=u.getCurrentAvosUser()}),s.fromTemplateUrl("template/noBarCodeModalView.html",{scope:o}).then(function(e){o.noBarCodeModalView=e}),o.scanQRBtnOnClick=function(){r.scanQRCode(function(e){o.usedBookInfo.isbn13=e,c()})},o.submitOnClick=function(){o.isLoading=!0;var t=l.jsonUsedBookToAvos(o.usedBookInfo);t.save(null).done(function(){e.go("tab.person_usedBooksList"),n.clearHistory()}).fail(function(o){alert(o.message)}).always(function(){o.isLoading=!1,o.$apply()})}}]).controller("person_editPersonInfo",["$scope","$state","$ionicHistory","InfoService$","User$","IonicModalView$",function(o,e,t,n,i,s){o.attrHasChange=!1,o.userInfo=i.getCurrentJsonUser(),s.registerChooseSchoolModalView(o,function(e){o.attrHasChange=!0,o.userInfo.school=e}),s.registerChooseMajorModalView(o,function(e){o.attrHasChange=!0,o.userInfo.major=e}),o.startSchoolYearOptions=n.startSchoolYearOptions,o.submitOnClick=function(){var n=readCookie("unionId");i.loginWithUnionId(n).done(function(n){n.fetchWhenSave(!0),n.save({school:o.userInfo.school,major:o.userInfo.major,startSchoolYear:o.userInfo.startSchoolYear}).done(function(){alert("修改成功")}).fail(function(o){alert("修改失败:"+o.message)}).always(function(){e.go("tab.person_my"),t.clearHistory()})})}}]).controller("person_my",["$scope","$state","$stateParams","User$",function(o,e,t,n){function i(){o.userInfo=n.getCurrentJsonUser(),n.getCurrentAvosUser().relation("usedBooks").query().count().done(function(e){o.myUsedBookNumber=e,o.$apply()});var e=AV.User.current().followeeQuery();e.count().done(function(e){o.followeeNumber=e,o.$apply()}),e=AV.User.current().followerQuery(),e.count().done(function(e){o.followerNumber=e,o.$apply()})}o.$on("$ionicView.afterEnter",i),o.logOut=function(){AV.User.logOut(),eraseCookie("unionId"),wx.closeWindow()}}]).controller("person_usedBookList",["$scope","UsedBook$",function(o,e){o.UsedBook$=e,o.$on("$ionicView.afterEnter",function(){e.loadMyAvosUsedBookList()})}]).controller("person_editOneUsedBook",["$scope","$state","$ionicHistory","$stateParams","UsedBook$",function(o,e,t,n,i){var s=n.indexInMyAvosUsedBook_notSell;o.avosUsedBook=i.myAvosUsedBookList[s],o.valueHasChange=!1,o.jsonUsedBookChangeInfo=i.avosUsedBookToJson(o.avosUsedBook),o.submitOnClick=function(){o.avosUsedBook.set("des",o.jsonUsedBookChangeInfo.des),o.avosUsedBook.set("price",o.jsonUsedBookChangeInfo.price),o.avosUsedBook.save(null).done(function(){e.go("tab.person_usedBooksList"),t.clearHistory()}).fail(function(o){alert(o.message)})}}]).controller("person_sendMsgToUser",["$scope","$state","$stateParams","$ionicHistory","$ionicScrollDelegate","User$","UsedBook$","Status$",function(o,e,t,n,i,s,a,r){var l=t.receiverObjectId;o.isLoading=!1,o.msg={inboxType:t.inboxType,role:t.role,sendMsg:"",usedBookObjectId:t.usedBookObjectId},o.nowModel=function(){if("private"==o.msg.inboxType){if("sell"==o.msg.role)return"回应卖家的私信";if("buy"==o.msg.role)return"给图书主人发私信"}else if("reviewUsedBook"==o.msg.inboxType){if("sell"==o.msg.role)return"回复买家对旧书的评论";if("buy"==o.msg.role)return"对主人的旧书发表评论"}},AV.Object.createWithoutData("_User",l).fetch().done(function(e){o.jsonUser=s.avosUserToJson(e),o.$apply()}),o.jsonStatusList=[],r.getStatusList_twoUser(l,o.msg.usedBookObjectId).done(function(e){for(var t=0;t<e.length;t++)o.jsonStatusList.push(r.avosStatusToJson(e[t]))}),o.commonReplayWords=[],o.commonReplayWords="sell"==o.msg.role?["求微信号","成交","不能再便宜了","这本书已经卖出去了"]:["求微信号","成交","可以再便宜点吗?","你在什么地方?","书有破损吗?"],o.msg.usedBookObjectId&&a.getJsonUsedBookByAvosObjectId(o.msg.usedBookObjectId,function(e){o.jsonUsedBook=e,o.$apply()}),o.sendOnClick=function(){o.isLoading=!0;var e;"private"==o.msg.inboxType?e=r.sendPrivateMsg(l,o.msg.sendMsg,o.msg.role):"reviewUsedBook"==o.msg.inboxType&&(e=r.reviewUsedBook(o.msg.usedBookObjectId,o.msg.sendMsg,o.msg.role)),e.done(function(){o.jsonStatusList.push({message:o.msg.sendMsg}),i.scrollBottom(!0)}).fail(function(o){alert("发送失败:"+JSON.stringify(o))}).always(function(){o.isLoading=!1,o.msg.sendMsg="",o.$apply()})}}]).controller("signUp",["$scope","$timeout","$state","$stateParams","$ionicHistory","$ionicModal","WeChatJS$","InfoService$","User$","Status$","IonicModalView$",function(o,e,t,n,i,s,a,r,l,u,c){o.isLoading=!0;var d=n.code,b=n.state;a.getOAuthUserInfo(d,function(e){o.isLoading=!1,o.userInfo=e,l.loginWithUnionId(e.unionId).done(function(o){u.loadUnreadStatusesCount(),t.go(b),i.clearHistory(),o.save({nickName:e.nickname,sex:e.sex,avatarUrl:e.headimgurl})}),o.$apply()}),c.registerChooseSchoolModalView(o,function(e){o.userInfo.school=e}),c.registerChooseMajorModalView(o,function(e){o.userInfo.major=e}),o.startSchoolYearOptions=r.startSchoolYearOptions,o.submitOnClick=function(){o.isLoading=!0,l.signUpWithJSONUser(o.userInfo).done(function(){t.go(b),i.clearHistory()}).fail(function(o){alert(o.message)}).always(function(){o.isLoading=!1,o.$apply()})}}]).controller("hello",["$scope","$state","$stateParams","WeChatJS$","User$",function(o,e,t,n,i){var s=t.state;i.loginWithUnionId(readCookie("unionId")).done(function(){e.go(s),$ionicHistory.clearHistory()}),o.OAuthURL=n.getOAuthURL(s)}]).controller("userList",["$scope","$stateParams","UsedBook$","BookRecommend$","User$",function(o,e,t,n,i){var s=e.cmd;o.sortWay="","near"==s?(o.title="你附近的同学",o.jsonUsers=n.NearUser.jsonUsers,o.loadMore=n.NearUser.loadMore,o.hasMore=n.NearUser.hasMore):"followee"==s?(o.title="我关注的同学",o.jsonUsers=i.Followee.jsonUserList,o.loadMore=i.Followee.loadMore,o.hasMore=i.Followee.hasMore):"follower"==s&&(o.title="我的粉丝",o.jsonUsers=i.Follower.jsonUserList,o.loadMore=i.Follower.loadMore,o.hasMore=i.Follower.hasMore)}]).controller("userHome",["$scope","$stateParams","UsedBook$","User$",function(o,e,t,n){o.UsedBook$=t;var i=e.ownerId,s=new AV.Query(AV.User);o.jsonUsedBookList=[],s.get(i).done(function(e){o.jsonOwnerInfo=n.avosUserToJson(e),t.loadUsedBookListForOwner(e).done(function(e){for(var n=0;n<e.length;n++)o.jsonUsedBookList.push(t.avosUsedBookToJson(e[n]));o.$apply()})})}]),APP.directive("reviewStar",function(){function o(o,e){var t=o.numStars,n=o.score,i=o.numRaters,s='<i class="icon ion-ios-star energized"></i>',a='<i class="icon ion-ios-star-outline"></i>';e.append("<i>"+n+"分&nbsp</i>"),e.append("<i>"+i+"人参与&nbsp</i>");for(var r=1;5>=r;r++){var l;l=t>=r?angular.element(s).clone():angular.element(a).clone(),e.append(l)}}return{restrict:"E",scope:{numStars:"@",score:"@",numRaters:"@"},link:o}}).directive("userInfo",["WeChatJS$","User$",function(o,e){function t(t){function n(){if(t.jsonUserInfo){var o=AV.Object.createWithoutData("_User",t.jsonUserInfo.objectId);o.relation("usedBooks").query().count().done(function(o){t.userUsedBookNumber=o,t.$apply()})}}function i(){if(t.jsonUserInfo){var o=AV.User.current().followeeQuery();o.equalTo("followee",AV.Object.createWithoutData("_User",t.jsonUserInfo.objectId)),o.count().done(function(o){t.isMyFollowee=1==o,t.$apply()})}}t.WeChatJS$=o,t.User$=e,t.isMyFollowee=!1,t.$watch(function(){return t.jsonUserInfo},function(){i(),(null==t.hideUsedBook||0==t.hideUsedBook)&&n()}),t.$on("FollowSomeone",function(){i()}),t.$on("UnfollowSomeone",function(){i()})}return{restrict:"E",scope:{jsonUserInfo:"=",hideUsedBook:"=?"},templateUrl:"temp/tool/userInfoTemplate.html",link:t}}]).directive("doubanBookOneLine",function(){return{restrict:"E",scope:{jsonBooksInfo:"="},templateUrl:"temp/tool/doubanBookOneLineTemplate.html",link:function(o){o.showNumber=Math.floor(document.body.clientWidth/80)}}}).directive("usedBookOneLine",function(){return{restrict:"E",scope:{jsonBooksInfo:"="},templateUrl:"temp/tool/usedBookOneLineTemplate.html",link:function(o){o.showNumber=Math.floor(document.body.clientWidth/80)}}}).directive("oneUsedBook",function(){return{restrict:"E",scope:{jsonUsedBook:"="},templateUrl:"temp/tool/oneUsedBookTemplate.html"}}),angular.module("APP").run(["$templateCache",function(o){o.put("temp/tabs.html",'<ion-tabs ng-controller="tabs" class="tabs-icon-top"><ion-tab title="图书" icon-on="ion-ios-book balanced" icon-off="ion-ios-book-outline" ui-sref="tab.book_recommend"><ion-nav-view name="tab-book"></ion-nav-view></ion-tab><ion-tab title="个人" icon-on="ion-ios-person balanced" icon-off="ion-ios-person-outline" ui-sref="tab.person_my" badge="Status$.unreadStatusesCount" badge-style="badge-assertive"><ion-nav-view name="tab-person"></ion-nav-view></ion-tab></ion-tabs>'),o.put("temp/book/bookList.html",'<ion-view ng-controller="book_bookList" view-title="{{title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><ion-list><ion-item class="item-thumbnail-left" collection-repeat="book in books" ui-sref="tab.book_oneBook({isbn13:book.isbn13})"><img ng-src="{{book.image}}"><h2>{{book.title}}</h2><p ng-if="book[\'publisher\']">{{book[\'publisher\']}}/{{book[\'pubdate\']}}</p><p ng-if="book.author">{{book.author.toString()}}</p><p ng-if="book.price">{{book.price}}</p></ion-item></ion-list><ion-infinite-scroll ng-if="hasMore()" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-view>'),
o.put("temp/book/bookReview.html",'<ion-view ng-controller="book_bookReview" view-title="{{title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><ion-item ng-repeat="one in BookReview.reviewList" class="item-avatar"><img ng-src="{{one.avatarUrl}}"><h3>{{one.title}}</h3><p style="white-space: pre-wrap">{{one.context}}</p><button class="button button-clear button-balanced button-small" style="float: right" ng-click="showFull(one.title,one.reviewId)">查看全部</button></ion-item><ion-infinite-scroll ng-if="BookReview.hasMore()" on-infinite="BookReview.loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-view>'),o.put("temp/book/oneBook.html",'<ion-view ng-controller="book_oneBook" view-title="{{book.title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><div style="text-align: center;padding-top: 10px" ng-if="isLoading"><ion-spinner icon="ripple" class="spinner-balanced"></ion-spinner></div><div class="list card"><ion-item style="text-align: center"><img ng-src="{{book.image}}" style="height: 180px" ng-click="WeChatJS$.previewOneImage(book.image)"></ion-item><ion-item ng-if="book.summary" class="item-button-right"><h3>简介</h3><p style="white-space: pre-wrap">{{book.summary.substr(0,30)}}...</p><button class="button button-clear button-balanced" ng-click="showSummary()">详情</button></ion-item><ion-item ng-if="book.author.length>0" class="item-button-right">{{book.author.toString()}} 著 <button class="button button-small button-clear button-balanced" ng-if="book.author_intro" ng-click="showAuthorIntro()">作者简介</button></ion-item><ion-item class="item-button-right"><i ng-if="book.price">定价:{{book.price}}</i> <i>&nbsp;</i> <i ng-if="book[\'publisher\']">{{book[\'publisher\']}}/{{book[\'pubdate\']}}</i> <button class="button button-small button-clear button-balanced" ng-click="showPubInfo()">出版</button></ion-item><ion-item ng-if="book[\'rating\']" class="item-button-right"><review-star num-stars="{{book[\'rating\'][\'average\']/2}}" score="{{book[\'rating\'][\'average\']}}" num-raters="{{book[\'rating\'][\'numRaters\']}}"></review-star><button class="button button-small button-clear button-balanced" ui-sref="tab.book_bookReview({doubanBookId:book.id,bookTitle:book.title})">书评</button></ion-item></div><div class="list card" ng-if="businessInfos.length>0"><ion-item class="item-divider">购买新书</ion-item><ion-item style="white-space:normal"><a class="button button-small button-outline button-balanced" style="margin: 5px" ng-repeat="info in businessInfos | orderBy:\'price\'" ng-href="{{info.url}}">{{info.name}}/{{info.price}}</a></ion-item></div><div class="list card"><ion-item class="item-divider item-button-right">二手书 <button class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_uploadOneUsedBook({isbn13:book.isbn13})">上传旧书</button></ion-item><ion-item ng-if="usedBookNumber==0" style="text-align: center">还没有对应的二手书</ion-item><ion-item ng-if="UsedBook$.ISBN.nowEqualISBNJsonUsedBookList.length>0" ng-repeat="oneJsonUsedBook in UsedBook$.ISBN.nowEqualISBNJsonUsedBookList" class="item-avatar"><img ng-src="{{oneJsonUsedBook.owner.get(\'avatarUrl\')}}" ui-sref="tab.userHome({ownerId:oneJsonUsedBook.owner.id})"><div ui-sref="tab.book_oneUsedBook({usedBookAvosObjectId:oneJsonUsedBook.objectId})"><h3 style="white-space: pre-wrap">{{oneJsonUsedBook.price}}元 {{oneJsonUsedBook.des}}</h3><p>上传于:{{oneJsonUsedBook.updatedAt | date:\'mediumDate\' }}</p></div></ion-item><ion-item ng-if="UsedBook$.ISBN.nowEqualISBNJsonUsedBookList.length>0" style="padding: 0;text-align: center"><a class="button button-small button-clear button-balanced" ui-sref="tab.book_usedBookList({cmd:\'isbn\',isbn13:isbn13})">共{{usedBookNumber}}本旧书,查看全部</a></ion-item></div></ion-content></ion-view>'),o.put("temp/book/oneUsedBook.html",'<ion-view ng-controller="book_oneUsedBook" view-title="二手 {{jsonUsedBook.title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><div class="list card"><ion-item ng-if="jsonUsedBook.image" style="text-align: center"><img ng-src="{{jsonUsedBook.image}}" style="height: 180px" ng-click="WeChatJS$.previewOneImage(jsonUsedBook.image)"></ion-item><ion-item ui-sref="tab.book_oneBook({isbn13:jsonUsedBook.isbn13})"><h3>要价:{{jsonUsedBook.price}}</h3><p>时间:{{jsonUsedBook.updatedAt | date:\'mediumDate\' }}</p><p>书名:{{jsonUsedBook.title}}</p><p ng-if="jsonUsedBook.des" style="white-space: pre-wrap">描述:{{jsonUsedBook.des}}</p></ion-item></div><div class="list card"><ion-item class="item-divider item-button-right">主人信息 <a class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_sendMsgToUser({receiverObjectId:ownerInfo.objectId,usedBookObjectId:usedBookObjectId,role:\'buy\',inboxType:\'reviewUsedBook\'})">联系主人</a></ion-item><user-info json-user-info="ownerInfo"></user-info></div><div class="list card"><ion-item class="item-divider item-button-right">大家都说 <a class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_sendMsgToUser({receiverObjectId:ownerInfo.objectId,usedBookObjectId:usedBookObjectId,role:\'buy\',inboxType:\'reviewUsedBook\'})">我也要说</a></ion-item><ion-item ng-if="jsonStatusList.length==0" ui-sref="tab.person_sendMsgToUser({receiverObjectId:ownerInfo.objectId,usedBookObjectId:usedBookObjectId,role:\'buy\',inboxType:\'reviewUsedBook\'})">还没有同学评论,快来抢沙发~</ion-item><ion-item class="item-avatar" ng-repeat="jsonStatus in jsonStatusList"><img ng-src="{{User$.changeWechatAvatarSize(jsonStatus.source.get(\'avatarUrl\'),64)}}" ui-sref="tab.userHome({ownerId:jsonStatus.source.id})"><h2 style="white-space: pre-wrap">{{jsonStatus.message}}</h2><p>{{jsonStatus.updatedAt | date:\'mediumDate\'}}</p><img style="width: 40px;height: 40px;position: absolute;top: 16px;right: 16px;border-radius: 50%" ui-sref="tab.userHome({ownerId:jsonStatus.to.id})" ng-src="{{User$.changeWechatAvatarSize(jsonStatus.to.get(\'avatarUrl\'),64)}}"></ion-item></div></ion-content></ion-view>'),o.put("temp/book/recommend.html",'<ion-view ng-controller="book_recommend" view-title="书循"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><div ng-if="BookRecommend$[\'BookTag\'][\'tag\']"><ion-item class="item-divider item-button-right">图书分类 <button class="button button-small button-clear button-balanced" style="top: 0" ng-click="bookTagsModalView.show()">更多</button></ion-item><ion-item style="white-space:normal"><button class="button button-small button-outline button-balanced" style="margin: 5px" ui-sref="tab.book_bookList({cmd:\'tag\',tag:tag})" ng-repeat="tag in BookRecommend$[\'BookTag\'].getTagAttrNames()">{{tag}}</button></ion-item></div><div ng-if="BookRecommend$.NearBook.jsonBooks.length>0"><ion-item class="item-divider item-button-right">附近的旧书 <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.book_usedBookList({cmd:\'near\'})">更多</button></ion-item><used-book-one-line json-books-info="BookRecommend$.NearBook.jsonBooks"></used-book-one-line></div><div ng-if="BookRecommend$.MajorBook.books.length>0"><ion-item class="item-divider item-button-right">{{BookRecommend$.MajorBook.major}} <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.book_bookList({cmd:\'major\'})">更多</button></ion-item><douban-book-one-line json-books-info="BookRecommend$.MajorBook.books"></douban-book-one-line></div><div ng-if="BookRecommend$.NeedBook.books.length>0"><ion-item class="item-divider item-button-right">你可能需要 <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.book_bookList({cmd:\'need\'})">更多</button></ion-item><douban-book-one-line json-books-info="BookRecommend$.NeedBook.books"></douban-book-one-line></div><div ng-if="BookRecommend$.NewBook.books.length>0"><ion-item class="item-divider item-button-right">新书速递 <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.book_bookList({cmd:\'new\'})">更多</button></ion-item><douban-book-one-line json-books-info="BookRecommend$.NewBook.books"></douban-book-one-line></div><div ng-if="BookRecommend$.NearUser.jsonUsers.length>0"><ion-item class="item-divider item-button-right">附近的同学 <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.userList({cmd:\'near\'})">更多</button></ion-item><ion-item style="padding: 0;text-align: center"><img ng-repeat="one in BookRecommend$.NearUser.jsonUsers" ng-if="one.avatarUrl" ng-src="{{User$.changeWechatAvatarSize(one.avatarUrl,64)}}" ui-sref="tab.userHome({ownerId:one.objectId})" style="width: 40px;height: 40px;border-radius: 50%;overflow: hidden;margin: 5px"></ion-item></div></ion-content><script type="text/ng-template" id="template/bookTags.html"><ion-modal-view>\n            <ion-header-bar class="item-input-inset">\n                <h1 class="title">图书热门分类</h1>\n                <button class="button button-clear button-balanced"\n                        ng-click="bookTagsModalView.hide()">返回\n                </button>\n            </ion-header-bar>\n            <ion-content class="has-header">\n                <ion-list>\n                    <div ng-repeat="bigTag in BookRecommend$[\'BookTag\'].getTagAttrNames()">\n                        <ion-item class="item-divider item-button-right">{{bigTag}}</ion-item>\n                        <ion-item style="white-space:normal">\n                            <button class="button button-small button-outline button-balanced" style="margin: 5px"\n                                    ui-sref="tab.book_bookList({cmd:\'tag\',tag:tag})"\n                                    ng-click="bookTagsModalView.hide()"\n                                    ng-repeat="tag in BookRecommend$[\'BookTag\'][\'tag\'][bigTag]">\n                                {{tag}}\n                            </button>\n                        </ion-item>\n                    </div>\n                </ion-list>\n            </ion-content>\n        </ion-modal-view></script></ion-view>'),o.put("temp/book/searchList.html",'<ion-view view-title="图书搜索"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_recommend">书循</button></ion-nav-buttons><ion-content ng-controller="book_searchList"><ion-list><ion-item class="item-input-inset"><button class="button button-small button-clear" ng-click="scanQRBtnOnClick()">扫码</button><label class="item-input-wrapper"><i class="icon ion-search placeholder-icon"></i> <input type="search" placeholder="书名 作者 ISBN" ng-model="SearchBook$.keyword" ng-change="SearchBook$.searchInputOnChange()"></label><button class="button button-small button-clear" ng-click="SearchBook$.searchBtnOnClick()">搜索</button></ion-item><ion-item class="item-thumbnail-left" collection-repeat="book in SearchBook$.books" ui-sref="tab.book_oneBook({isbn13:book.isbn13})"><img ng-src="{{book.image}}"><h2>{{book.title}}</h2><p ng-if="book[\'publisher\']">{{book[\'publisher\']}}/{{book[\'pubdate\']}}</p><p ng-if="book.author">{{book.author.toString()}}</p><p ng-if="book.price">{{book.price}}</p></ion-item></ion-list><ion-infinite-scroll ng-if="SearchBook$.hasMore()" on-infinite="SearchBook$.loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-view>'),o.put("temp/book/usedBookList.html",'<ion-view ng-controller="book_usedBookList" view-title="{{title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_searchList">寻书</button></ion-nav-buttons><ion-content><div class="button-bar padding"><a class="button button-small" ng-click="sortWay=\'price\'" ng-class="{\'button-balanced\':sortWay==\'price\'}">图书价格</a> <a class="button button-small" ng-click="sortWay=\'location\'" ng-class="{\'button-balanced\':sortWay==\'location\'}">离你距离</a></div><ion-list><one-used-book ng-repeat="jsonUsedBook in jsonUsedBooks | orderBy:sortWay" json-used-book="jsonUsedBook"></one-used-book></ion-list><ion-infinite-scroll ng-if="hasMore()" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-view>'),o.put("temp/person/editOneUsedBook.html",'<ion-view ng-controller="person_editOneUsedBook" view-title="编辑你的 图书名称"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.person_my">我</button></ion-nav-buttons>+<ion-content class="padding"><div class="list card"><ion-item style="text-align: center"><img ng-src="{{avosUsedBook.get(\'image\')}}" style="height: 180px"></ion-item></div><div class="list card"><label class="item item-input item-stacked-label"><span class="input-label">描述</span> <input type="text" placeholder="这书有什么特别之处" ng-model="jsonUsedBookChangeInfo.des" ng-change="valueHasChange=true"></label><label class="item item-input item-stacked-label"><span class="input-label">要价</span> <input type="number" placeholder="人民币 只输入数值" ng-model="jsonUsedBookChangeInfo.price" ng-change="valueHasChange=true"></label></div><button class="button button-block button-outline button-balanced" ng-click="submitOnClick()" ng-disabled="!valueHasChange">提交修改</button></ion-content></ion-view>'),o.put("temp/person/editPersonInfo.html",'<ion-view ng-controller="person_editPersonInfo" view-title="修改你的信息"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.person_my">我</button></ion-nav-buttons><ion-content class="padding"><user-info json-user-info="userInfo"></user-info><div class="list list-inset"><ion-item class="item-icon-right" ng-click="chooseSchoolModalView.show()">在读学校 <span class="item-note" ng-if="userInfo.school">{{userInfo.school}}</span> <i class="icon ion-ios-arrow-right balanced"></i></ion-item><ion-item class="item-icon-right" ng-click="chooseMajorModalView.show()">所学专业 <span class="item-note" ng-if="userInfo.major">{{userInfo.major}}</span> <i class="icon ion-ios-arrow-right balanced"></i></ion-item><label class="item item-input item-select"><span class="input-label">大学入学时间</span><select ng-model="userInfo.startSchoolYear" ng-change="attrHasChange=true" ng-options="one as one for one in startSchoolYearOptions"></select></label></div><button class="button button-block button-outline button-balanced" ng-click="submitOnClick()" ng-disabled="!attrHasChange">提交修改</button></ion-content></ion-view>'),o.put("temp/person/my.html",'<ion-view ng-controller="person_my" view-title="我的书循"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ng-click="logOut()">退出</button></ion-nav-buttons><ion-content><ion-item class="item-divider item-button-right">我的信息 <button class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_editPersonInfo">修改信息</button></ion-item><user-info ng-if="userInfo" json-user-info="userInfo" hide-used-book="true"></user-info><ion-item class="item-divider item-button-right">我的二手书 <button class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_uploadOneUsedBook">上传旧书</button></ion-item><ion-item ng-if="myUsedBookNumber>0" ui-sref="tab.person_usedBooksList" class="item-icon-right">已上传{{myUsedBookNumber}}本旧书 <i class="icon ion-ios-arrow-right balanced"></i></ion-item><ion-item class="item-divider item-button-right">我关注的同学 <button class="button button-small button-clear button-balanced" style="top: 0" ui-sref="tab.userList({cmd:\'near\'})">附近的同学</button></ion-item><ion-item ng-if="followeeNumber>0" ui-sref="tab.userList({cmd:\'followee\'})" class="item-icon-right">已关注{{followeeNumber}}位同学 <i class="icon ion-ios-arrow-right balanced"></i></ion-item><ion-item ng-if="followeeNumber==0" ui-sref="tab.userList({cmd:\'near\'})">你还没有关注的同学,去逛逛</ion-item><ion-item class="item-divider">我的粉丝</ion-item><ion-item ng-if="followerNumber>0" ui-sref="tab.userList({cmd:\'follower\'})" class="item-icon-right">有{{followerNumber}}位同学关注我 <i class="icon ion-ios-arrow-right balanced"></i></ion-item><ion-item ng-if="followerNumber==0" ui-sref="tab.userList({cmd:\'follower\'})" class="item-icon-right">还没有粉丝,去发点什么吧</ion-item></ion-content></ion-view>'),o.put("temp/person/sendMsgToUser.html",'<ion-view ng-controller="person_sendMsgToUser" view-title="回复{{jsonUser.nickName}}"><style>.message {\n            display: block;\n            clear: both;\n            border-radius: 10px;\n            padding: 5px;\n            margin: 5px;\n            max-width: 80%;\n            white-space: normal;\n        }</style><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.person_my">我</button></ion-nav-buttons><ion-content><user-info ng-if="jsonUser" json-user-info="jsonUser"></user-info><one-used-book ng-if="jsonUsedBook" json-used-book="jsonUsedBook"></one-used-book><ion-item style="margin: 0;padding: 0;border-right: none;border-left: none"><ol ng-if="jsonStatusList.length>0" style="margin: 5px;padding: 0;list-style-type:none"><li ng-repeat="jsonStatus in jsonStatusList" class="message" ng-style="{float:jsonStatus.source.id==jsonUser.objectId ? \'left\':\'right\',backgroundColor:jsonStatus.source.id==jsonUser.objectId ? \'#30bf4c\':\'#e6e5eb\'}">{{jsonStatus.message}}</li></ol></ion-item><ion-item class="item-divider" style="text-align: center" ng-if="nowModel()">{{nowModel()}}</ion-item><label class="item item-input"><input type="text" ng-model="msg.sendMsg" placeholder="输入回复内容"></label><button ng-disabled="!msg.sendMsg || isLoading" class="button button-block button-outline button-balanced" ng-click="sendOnClick()">发送</button><div style="text-align: center;padding-top: 10px" ng-if="isLoading"><ion-spinner icon="ripple" class="spinner-balanced"></ion-spinner></div><ion-list ng-if="commonReplayWords.length>0"><ion-item class="item-divider item-button-right">快速回复内容</ion-item><ion-item style="white-space:normal;padding: 5px"><button class="button button-small button-outline button-balanced" style="margin: 5px" ng-disabled="isLoading" ng-repeat="word in commonReplayWords" ng-click="msg.sendMsg=word">{{word}}</button></ion-item></ion-list></ion-content></ion-view>'),o.put("temp/person/uploadOneUsedBook.html",'<ion-view ng-controller="person_uploadOneUsedBook" view-title="上传二手书"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.person_my">我</button></ion-nav-buttons><ion-content style="text-align: center" class="padding"><div style="text-align: center;padding-top: 10px" ng-if="isLoading"><ion-spinner icon="ripple" class="spinner-balanced"></ion-spinner></div><div ng-if="!usedBookInfo.isbn13"><h5>扫码书后面的条形码获得图书信息</h5><button class="button button-outline button-balanced" ng-click="scanQRBtnOnClick()">扫条形码</button><br><button class="button button-clear button-small button-balanced" ng-click="noBarCodeModalView.show()">没条码?</button></div><div class="list card" ng-if="usedBookInfo.isbn13"><ion-item style="text-align: center"><img ng-src="{{doubanBookInfo.image}}" style="height: 180px" ng-click="WeChatJS$.previewOneImage(doubanBookInfo.image)"></ion-item><ion-item><p>{{doubanBookInfo.title}} <span ng-if="doubanBookInfo.price">{{doubanBookInfo.price}}</span></p><p ng-if="doubanBookInfo.author.length>0">{{doubanBookInfo.author.toString()}} 著</p><p ng-if="doubanBookInfo[\'publisher\']">{{doubanBookInfo[\'publisher\']}} {{doubanBookInfo[\'pubdate\']}}</p></ion-item></div><hr style="margin: 10px"><div class="list list-inset"><label class="item item-input"><input type="number" ng-model="usedBookInfo.price" placeholder="输入要价(人民币)"></label><label class="item item-input"><input type="text" ng-model="usedBookInfo.des" placeholder="对这本书你还有什么想说的吗?"></label></div><button ng-disabled="!(!isLoading && usedBookInfo.isbn13 && usedBookInfo.price)" class="button button-block button-outline button-balanced" ng-click="submitOnClick()">提交二手书</button></ion-content><script type="text/ng-template" id="template/noBarCodeModalView.html"><ion-modal-view>\n            <ion-header-bar>\n                <h2 class="title">书没条码时上传方法</h2>\n                <button class="button button-clear button-balanced"\n                        ng-click="noBarCodeModalView.hide()">返回\n                </button>\n            </ion-header-bar>\n            <ion-content class="padding" style="text-align: center">\n                <img style="max-width: 98%" ng-src="img/noCodeBar.png">\n                <button class="button button-block button-outline button-balanced" ui-sref="tab.book_searchList"\n                        ng-click="noBarCodeModalView.hide()">\n                    开始上传\n                </button>\n            </ion-content>\n        </ion-modal-view></script></ion-view>'),o.put("temp/person/usedBookList.html",'<ion-view ng-controller="person_usedBookList" view-title="管理我的二手图书"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.person_my">我</button></ion-nav-buttons><ion-content><ion-list><div style="text-align: center;margin: 10px" ng-if="UsedBook$.isLoading"><ion-spinner icon="ripple" class="spinner-balanced"></ion-spinner></div><ion-item class="item-divider item-button-right">正在架上 <button class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_uploadOneUsedBook({isbn13:book.isbn13})">上传旧书</button></ion-item><ion-item ng-repeat="oneAvosUsedBook in UsedBook$.myAvosUsedBookList" class="item-thumbnail-left"><img ng-if="oneAvosUsedBook.get(\'image\')" ng-src="{{oneAvosUsedBook.get(\'image\')}}" ui-sref="tab.book_oneBook({isbn13:oneAvosUsedBook.get(\'isbn13\')})"><p ng-if="oneAvosUsedBook.get(\'price\')">要价:{{oneAvosUsedBook.get(\'price\')}}</p><p ng-if="oneAvosUsedBook.get(\'title\')">书名:{{oneAvosUsedBook.get(\'title\')}}</p><p ng-if="oneAvosUsedBook.get(\'des\')">描述:{{oneAvosUsedBook.get(\'des\')}}</p><button class="button button-small button-outline button-assertive" ng-click="UsedBook$.removeUsedBook(oneAvosUsedBook)">已卖删除</button> <button class="button button-small button-outline button-balanced" ui-sref="tab.person_editOneUsedBook({indexInMyAvosUsedBook_notSell:$index})">修改信息</button></ion-item><ion-item ng-if="UsedBook$.myAvosUsedBookList.length==0">你还没有上传过书,点击 上传旧书</ion-item><ion-item ui-sref="tab.person_uploadOneUsedBook({isbn13:book.isbn13})" style="text-align: center">继续上传旧书</ion-item></ion-list></ion-content></ion-view>'),o.put("temp/tool/chooseMajorModalView.html",'<ion-modal-view><ion-header-bar class="item-input-inset"><label class="item-input-wrapper"><i class="icon ion-ios7-search placeholder-icon"></i> <input type="search" placeholder="输入名称搜索" ng-model="InfoService$.searchMajorKeyword"></label><button class="button button-clear button-balanced" ng-click="chooseMajorModalView.hide()">返回</button></ion-header-bar><ion-content class="has-header"><ul class="list"><ion-item item-height="55px" item-width="100%" collection-repeat="oneMajor in InfoService$.majors | filter:InfoService$.filter_majorByKeyword" ng-click="majorOnChoose(oneMajor[\'name\'])">{{oneMajor[\'name\']}}</ion-item></ul></ion-content></ion-modal-view>'),o.put("temp/tool/chooseSchoolModalView.html",'<ion-modal-view><ion-header-bar class="item-input-inset"><button class="button button-clear button-balanced" ng-click="InfoService$.School.loadMore()">搜索</button><label class="item-input-wrapper"><i class="icon ion-ios7-search placeholder-icon"></i> <input type="search" placeholder="输入名称搜索" ng-model="InfoService$.School.searchSchoolKeyword"></label><button class="button button-clear button-balanced" ng-click="chooseSchoolModalView.hide()">返回</button></ion-header-bar><ion-content class="has-header"><ul class="list"><ion-item item-height="55px" item-width="100%" collection-repeat="school in InfoService$.School.schools | filter:InfoService$.School.filter_schoolByKeyword" ng-click="schoolOnChoose(school)">{{school}}</ion-item></ul><ion-infinite-scroll on-infinite="InfoService$.School.loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-modal-view>'),o.put("temp/tool/doubanBookOneLineTemplate.html",'<ion-item style="text-align: center;padding: 0"><div ng-repeat="jsonBook in jsonBooksInfo.slice(0,showNumber)" ui-sref="tab.book_oneBook({isbn13:jsonBook.isbn13})" style="display: inline-block;padding: 5px;width: 80px;height: 120px"><img ng-if="jsonBook.image" ng-src="{{jsonBook.image}}" style="width: 70px;height: 100px"><h5 ng-if="jsonBook.title" class="title">{{jsonBook.title}}</h5></div></ion-item>'),o.put("temp/tool/hello.html",'<ion-view ng-controller="hello" view-title="需要验证你的身份"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_recommend">书循</button></ion-nav-buttons><ion-content style="text-align: center"><hr style="margin: 30px"><a class="button button-outline button-balanced" ng-href="{{OAuthURL}}">进入书循</a></ion-content></ion-view>'),o.put("temp/tool/oneUsedBookTemplate.html",'<ion-item class="item-thumbnail-left" ui-sref="tab.book_oneUsedBook({usedBookAvosObjectId:jsonUsedBook.objectId})"><img ng-if="jsonUsedBook.image" ng-src="{{jsonUsedBook.image}}"><h3>要价:{{jsonUsedBook.price}}</h3><h4>{{jsonUsedBook.updatedAt | date:\'mediumDate\' }}</h4><p ng-if="jsonUsedBook.title">书名:{{jsonUsedBook.title}}</p><p ng-if="jsonUsedBook.des">描述:{{jsonUsedBook.des}}</p></ion-item>'),o.put("temp/tool/signUp.html",'<ion-view ng-controller="signUp" view-title="加入书循"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_recommend">书循</button></ion-nav-buttons><ion-content class="padding"><div style="text-align: center;margin: 5px" ng-if="isLoading"><ion-spinner icon="ripple" class="spinner-balanced"></ion-spinner></div><div class="item item-avatar" ng-if="userInfo.openId"><img ng-src="{{userInfo.avatarUrl}}"><h2>{{userInfo.nickName}} <i class="icon ion-male" style="color: #5eb1ed" ng-if="userInfo.sex==1"></i> <i class="icon ion-female" style="color: #ff6d9e" ng-if="userInfo.sex==2"></i></h2></div><div class="list list-inset"><ion-item class="item-icon-right" ng-click="chooseSchoolModalView.show()">你在读的学校 <span class="item-note" ng-if="userInfo.school">{{userInfo.school}}</span> <i class="icon ion-ios-arrow-right balanced"></i></ion-item><ion-item class="item-icon-right" ng-click="chooseMajorModalView.show()">你所学的专业 <span class="item-note" ng-if="userInfo.major">{{userInfo.major}}</span> <i class="icon ion-ios-arrow-right balanced"></i></ion-item><label class="item item-input item-select"><span class="input-label">大学入学时间</span><select ng-model="userInfo.startSchoolYear"><option ng-repeat="one in startSchoolYearOptions" value="{{one}}">{{one}}</option></select></label></div><button class="button button-block button-outline button-balanced" ng-click="submitOnClick()" ng-disabled="isLoading || !(userInfo.school && userInfo.major && userInfo.startSchoolYear)">立即加入</button></ion-content></ion-view>'),o.put("temp/tool/titleAndPreModalView.html",'<ion-modal-view><ion-header-bar><h2 class="title">{{titleAndPreModalViewData.title}}</h2><button class="button button-clear button-balanced" ng-click="titleAndPreModalView.hide()">返回</button></ion-header-bar><ion-content class="padding"><pre>{{titleAndPreModalViewData.pre}}</pre></ion-content></ion-modal-view>'),o.put("temp/tool/usedBookOneLineTemplate.html",'<ion-item style="text-align: center;padding: 0"><div ng-repeat="jsonBook in jsonBooksInfo.slice(0,showNumber)" ui-sref="tab.book_oneBook({isbn13:jsonBook.isbn13})" style="display: inline-block;padding: 5px;width: 80px;height: 134px"><h5 class="title">{{jsonBook.des}}</h5><img ng-if="jsonBook.image" ng-src="{{jsonBook.image}}" style="width: 70px;height: 100px"><h5 class="title">{{jsonBook.title}}</h5></div></ion-item>'),o.put("temp/tool/userHome.html",'<ion-view ng-controller="userHome" view-title="主人的二手书"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_recommend">书循</button></ion-nav-buttons><ion-content><ion-list><ion-item class="item-divider item-button-right">主人信息 <a class="button button-clear button-balanced" style="top: 0" ui-sref="tab.person_sendMsgToUser({receiverObjectId:jsonOwnerInfo.objectId,role:\'buy\',inboxType:\'private\'})">联系主人</a></ion-item><user-info json-user-info="jsonOwnerInfo" hide-used-book="true"></user-info><one-used-book ng-if="jsonUsedBookList.length>0" ng-repeat="oneJsonUsedBook in jsonUsedBookList" json-used-book="oneJsonUsedBook"></one-used-book><ion-item ng-if="jsonUsedBookList.length==0" style="text-align: center;padding: 0"><a class="button button-small button-clear button-balanced" ui-sref="tab.book_recommend">主人还没旧书要卖,再去逛逛</a></ion-item></ion-list></ion-content></ion-view>'),o.put("temp/tool/userInfoTemplate.html",'<div class="item item-avatar" ng-if="jsonUserInfo"><img ng-src="{{User$.changeWechatAvatarSize(jsonUserInfo.avatarUrl,64)}}"><h2>{{jsonUserInfo.nickName}} <i class="icon ion-male" style="color: #5eb1ed" ng-if="jsonUserInfo.sex==1"></i> <i class="icon ion-female" style="color: #ff6d9e" ng-if="jsonUserInfo.sex==2"></i> <i>{{jsonUserInfo.startSchoolYear}}级</i></h2><p style="white-space: pre-wrap">{{jsonUserInfo.major}}/{{jsonUserInfo.school}}</p><button ng-if="User$.getCurrentAvosUser && jsonUserInfo.objectId!=User$.getCurrentAvosUser().id" class="button button-small button-clear button-balanced" style="float: right" ui-sref="tab.person_sendMsgToUser({receiverObjectId:jsonUserInfo.objectId,role:\'buy\',inboxType:\'private\'})">发私信</button> <button ng-if="jsonUserInfo.location" class="button button-small button-clear button-balanced" style="float: right" ng-click="WeChatJS$.openMap(jsonUserInfo.location.latitude,jsonUserInfo.location.longitude)">地图</button> <button ng-if="User$.getCurrentAvosUser && jsonUserInfo.objectId!=User$.getCurrentAvosUser().id && !isMyFollowee" class="button button-small button-clear button-balanced" style="float: right" ng-click="User$.followUser(jsonUserInfo.objectId)">关注Ta</button> <button ng-if="isMyFollowee" class="button button-small button-clear button-energized" style="float: right" ng-click="User$.unfollowUser(jsonUserInfo.objectId)">取消关注</button></div><ion-item ng-if="!hideUsedBook && userUsedBookNumber" style="padding: 0;text-align: center"><a ng-if="userUsedBookNumber>0" class="button button-small button-clear button-balanced" ui-sref="tab.userHome({ownerId:jsonUserInfo.objectId})">查看主人要卖的{{userUsedBookNumber}}本旧书</a> <a ng-if="userUsedBookNumber==0" class="button button-small button-clear button-balanced">主人还没有在买的二手书</a></ion-item>'),o.put("temp/tool/userList.html",'<ion-view ng-controller="userList" view-title="{{title}}"><ion-nav-buttons side="right"><button class="button button-clear button-balanced" ui-sref="tab.book_recommend">书循</button></ion-nav-buttons><ion-content class="padding"><div class="button-bar"><a class="button button-small" ng-click="sortWay=\'usedBookNumber\'" ng-class="{\'button-balanced\':sortWay==\'usedBookNumber\'}">旧书数量</a> <a class="button button-small" ng-click="sortWay=\'location\'" ng-class="{\'button-balanced\':sortWay==\'location\'}">离你距离</a></div><div class="card" ng-repeat="one in jsonUsers | orderBy:sortWay:true"><user-info json-user-info="one"></user-info></div><ion-infinite-scroll ng-if="hasMore()" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll></ion-content></ion-view>')}]);